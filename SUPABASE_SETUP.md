# Supabase Database Setup Guide

## Why Notes Aren't Showing in Supabase

Your notes aren't appearing in Supabase because:
1. The `notes` table might not exist in your Supabase database
2. Row Level Security (RLS) policies might be blocking access
3. You need to sign out and sign in again with the UUID conversion fix

## Steps to Set Up Your Supabase Database

### Step 1: Create the Notes Table

1. **Go to your Supabase Dashboard**
   - Open https://supabase.com/dashboard
   - Select your project: `vtluiyrvrpkdbeeqmwdq`

2. **Open the SQL Editor**
   - Click on "SQL Editor" in the left sidebar
   - Click "New Query"

3. **Run the Schema**
   - Open the file `supabase_schema.sql` in your project
   - Copy ALL the SQL code
   - Paste it into the SQL Editor
   - Click "Run" or press Cmd/Ctrl + Enter

4. **Verify the Table**
   - Click on "Table Editor" in the left sidebar
   - You should now see a `notes` table
   - Check that it has these columns:
     - `id` (text, primary key)
     - `user_id` (uuid)
     - `video_id` (text)
     - `timestamp` (integer)
     - `text` (text)
     - `created_at` (timestamptz)
     - `updated_at` (timestamptz)

### Step 2: Fix the Sync Error

The sync is failing because your current session has the old numeric Google ID. You need to sign in again with the UUID conversion:

1. **In the extension popup:**
   - Click "Sign Out"
   
2. **Sign in again:**
   - Click "Sign in with Google"
   - Complete the authentication
   
3. **Check the console** - you should see:
   - "Google ID converted to UUID: [uuid-format]"
   - "YouTube Notes: Starting full sync..."
   - "YouTube Notes: Full sync complete"

4. **The sync status should now show:**
   - ✅ "Synced" (green)
   - Last sync timestamp

### Step 3: Test Note Syncing

1. **Go to any YouTube video**
2. **Add a note** using the notes panel
3. **Wait a few seconds** for sync to complete
4. **Check Supabase:**
   - Go to Table Editor → notes
   - You should see your note appear!

### Step 4: Verify Your Existing Notes

All your existing notes are stored locally in Chrome. After signing in:
- The background script will automatically sync all unsynced local notes
- You should see all your notes appear in Supabase within a few seconds

## Troubleshooting

### If notes still don't appear in Supabase:

1. **Check the background console for errors:**
   - Go to `chrome://extensions/`
   - Click "service worker" under your extension
   - Look for error messages

2. **Check if the table was created:**
   - Go to Supabase → Table Editor
   - Look for the `notes` table
   - If missing, run the SQL schema again

3. **Verify RLS is configured:**
   - Go to Supabase → Authentication → Policies
   - Look for the "Allow all operations with anon key" policy
   - If missing, the SQL didn't run completely

4. **Check your environment variables:**
   ```bash
   # In your terminal:
   cd /Users/panchaka/Documents/GitHub/yt-notes-app
   node -e "require('dotenv').config(); console.log('URL:', process.env.SUPABASE_URL); console.log('Key:', process.env.SUPABASE_ANON_KEY ? 'Set' : 'Not set');"
   ```

## Database Schema Details

The `notes` table stores:
- **id**: Unique identifier for each note (generated by the extension)
- **user_id**: UUID converted from Google user ID
- **video_id**: YouTube video ID (e.g., "dQw4w9WgXcQ")
- **timestamp**: Video timestamp in seconds where note was created
- **text**: The note content
- **created_at**: When the note was first created
- **updated_at**: When the note was last modified

## Security Note

The current setup uses a permissive RLS policy that allows all operations through your anon key. This is fine for a personal extension, but for production you should:
- Implement proper authentication
- Use Supabase Auth instead of Chrome Identity
- Add server-side validation

## Next Steps

After setting up the database:
1. Sign out and sign in again in the extension
2. Add a test note on YouTube
3. Check Supabase Table Editor to verify it appears
4. All your existing local notes will sync automatically

